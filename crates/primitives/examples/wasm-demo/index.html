<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>BMT Hasher Demo</title>
        <link data-trunk rel="css" href="styles.css" />
        <link data-trunk rel="rust" href="Cargo.toml" data-wasm-opt="0" />
    </head>
    <body>
        <main>
            <h1>Swarm Primitives Playground</h1>
            <p class="description">
                This demo shows the functionality covering BMT, chunks and icon
                generation from the nectar-primitives crate.
            </p>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-button active" data-tab="bmt-hasher">
                    BMT Hasher
                </button>
                <button class="tab-button" data-tab="chunk-creator">
                    Chunk Creator
                </button>
                <button class="tab-button" data-tab="icon-generator">
                    Icon Generator
                </button>
                <button class="tab-button" data-tab="benchmarks">
                    Performance Benchmarks
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- BMT Hasher Tab -->
                <div id="bmt-hasher" class="tab-pane active">
                    <div class="input-container">
                        <textarea
                            id="text-input"
                            placeholder="Enter text to hash... (max 4096 bytes)"
                            maxlength="4096"
                        ></textarea>
                        <div class="stats">
                            <div>
                                Text length:
                                <span id="text-length">0</span> bytes (max 4096)
                            </div>
                            <div class="span-control">
                                <label for="span-input">Span:</label>
                                <input
                                    type="number"
                                    id="span-input"
                                    min="0"
                                    value="0"
                                />
                            </div>
                        </div>
                    </div>

                    <div class="results">
                        <div class="result-box">
                            <h3>BMT Hash (Hex)</h3>
                            <pre id="hash-result" class="hash-output">
0x0000000000000000000000000000000000000000000000000000000000000000</pre
                            >
                            <button id="copy-button" class="copy">Copy</button>
                        </div>

                        <div class="visualizer">
                            <h3>Hash Bytes Visualization</h3>
                            <div id="byte-viz" class="byte-grid"></div>
                        </div>
                    </div>

                    <!-- Icon Visualization Options (Collapsible) -->
                    <details class="info-panel icon-config">
                        <summary>Icon Visualization Options</summary>
                        <div class="config-panel">
                            <div class="config-row">
                                <div class="config-group">
                                    <label for="hasher-icon-generator"
                                        >Icon Style:</label
                                    >
                                    <select id="hasher-icon-generator">
                                        <option value="Geometric">
                                            Geometric Patterns
                                        </option>
                                        <option value="Abstract">
                                            Abstract Art
                                        </option>
                                        <option value="Circular">
                                            Circular Icon
                                        </option>
                                        <option value="Pixelated">
                                            Pixelated Grid
                                        </option>
                                        <option value="Molecular">
                                            Molecular Structure
                                        </option>
                                    </select>
                                </div>

                                <div class="config-group">
                                    <label for="hasher-icon-shape"
                                        >Icon Shape:</label
                                    >
                                    <select id="hasher-icon-shape">
                                        <option value="Square">Square</option>
                                        <option value="Circle">Circle</option>
                                    </select>
                                </div>
                            </div>

                            <div class="config-group">
                                <label>Color Scheme:</label>
                                <div class="radio-options">
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="hasher-color-vibrant"
                                            name="hasher-color-scheme"
                                            value="Vibrant"
                                            checked
                                        />
                                        <label for="hasher-color-vibrant"
                                            >Vibrant</label
                                        >
                                    </div>
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="hasher-color-pastel"
                                            name="hasher-color-scheme"
                                            value="Pastel"
                                        />
                                        <label for="hasher-color-pastel"
                                            >Pastel</label
                                        >
                                    </div>
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="hasher-color-monochrome"
                                            name="hasher-color-scheme"
                                            value="Monochrome"
                                        />
                                        <label for="hasher-color-monochrome"
                                            >Monochrome</label
                                        >
                                    </div>
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="hasher-color-complementary"
                                            name="hasher-color-scheme"
                                            value="Complementary"
                                        />
                                        <label for="hasher-color-complementary"
                                            >Complementary</label
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Icon Preview -->
                        <div class="icon-preview-container">
                            <div id="bmt-icon-preview"></div>
                            <button id="download-bmt-icon" class="small-button">
                                Download Icon
                            </button>
                        </div>
                    </details>

                    <details class="info-panel">
                        <summary>About BMT Hasher</summary>
                        <p>
                            The Binary Merkle Tree (BMT) hasher is a specialized
                            content-addressing function that allows efficient
                            verification of data segments within a larger
                            payload. It enables inclusion proofs without
                            requiring all data to be available.
                        </p>
                        <p>
                            This implementation is part of the nectar-primitives
                            crate, compiled to WebAssembly for in-browser
                            computation.
                        </p>
                        <p>
                            <strong>Span</strong>: The span represents the total
                            length of data (in bytes) this chunk belongs to. It
                            can be different from the actual chunk size,
                            especially when dealing with large datasets split
                            across multiple chunks.
                        </p>
                    </details>
                </div>

                <!-- Icon Generator Tab -->
                <div id="icon-generator" class="tab-pane">
                    <div class="icon-generator-container">
                        <div class="input-section">
                            <h2>Chunk Configuration</h2>

                            <div class="form-group">
                                <label for="chunk-address"
                                    >Chunk Address (32 bytes, hex):</label
                                >
                                <div class="input-with-button">
                                    <input
                                        type="text"
                                        id="chunk-address"
                                        placeholder="Enter or generate a 32-byte address (64 hex characters)"
                                    />
                                    <button
                                        id="generate-random-address"
                                        class="inline-button"
                                    >
                                        Generate
                                    </button>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="chunk-type"
                                        >Chunk Type (hex):</label
                                    >
                                    <input
                                        type="text"
                                        id="chunk-type"
                                        placeholder="1-byte type (2 hex characters)"
                                        value="01"
                                    />
                                </div>

                                <div class="form-group half">
                                    <label for="chunk-version"
                                        >Version (hex):</label
                                    >
                                    <input
                                        type="text"
                                        id="chunk-version"
                                        placeholder="1-byte version (2 hex characters)"
                                        value="01"
                                    />
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="header-data"
                                    >Type-specific Header (hex):</label
                                >
                                <textarea
                                    id="header-data"
                                    rows="2"
                                    placeholder="Enter optional type-specific header data in hex"
                                ></textarea>
                            </div>

                            <div class="form-group">
                                <label for="payload-data"
                                    >Payload Data (hex):</label
                                >
                                <textarea
                                    id="payload-data"
                                    rows="3"
                                    placeholder="Enter optional payload data in hex"
                                ></textarea>
                            </div>

                            <h2>Icon Options</h2>

                            <div class="form-group">
                                <label for="icon-generator"
                                    >Icon Generator:</label
                                >
                                <select id="icon-generator">
                                    <option value="Geometric">
                                        Geometric Patterns
                                    </option>
                                    <option value="Abstract">
                                        Abstract Art
                                    </option>
                                    <option value="Circular">
                                        Circular Icon
                                    </option>
                                    <option value="Pixelated">
                                        Pixelated Grid
                                    </option>
                                    <option value="Molecular">
                                        Molecular Structure
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="icon-shape">Icon Shape:</label>
                                <select id="icon-shape">
                                    <option value="Square">Square</option>
                                    <option value="Circle">Circle</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Color Scheme:</label>
                                <div class="radio-options">
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="color-vibrant"
                                            name="color-scheme"
                                            value="Vibrant"
                                            checked
                                        />
                                        <label for="color-vibrant"
                                            >Vibrant</label
                                        >
                                    </div>
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="color-pastel"
                                            name="color-scheme"
                                            value="Pastel"
                                        />
                                        <label for="color-pastel">Pastel</label>
                                    </div>
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="color-monochrome"
                                            name="color-scheme"
                                            value="Monochrome"
                                        />
                                        <label for="color-monochrome"
                                            >Monochrome</label
                                        >
                                    </div>
                                    <div class="radio-option">
                                        <input
                                            type="radio"
                                            id="color-complementary"
                                            name="color-scheme"
                                            value="Complementary"
                                        />
                                        <label for="color-complementary"
                                            >Complementary</label
                                        >
                                    </div>
                                </div>
                            </div>

                            <button id="generate-icon" class="primary-button">
                                Generate Icon
                            </button>
                        </div>

                        <div class="output-section">
                            <h2>Generated Icon</h2>
                            <div class="icon-preview-container">
                                <div id="icon-preview"></div>
                            </div>

                            <div class="icon-controls">
                                <button id="copy-svg" class="control-button">
                                    Copy SVG
                                </button>
                                <button
                                    id="download-svg"
                                    class="control-button"
                                >
                                    Download SVG
                                </button>
                            </div>

                            <h3>SVG Code</h3>
                            <pre id="svg-output" class="code-output"></pre>

                            <h3>Example Icons</h3>
                            <div id="example-icons" class="examples-grid"></div>
                        </div>
                    </div>
                </div>

                <!-- Performance Benchmarks Tab -->
                <div id="benchmarks" class="tab-pane">
                    <h2>Performance Benchmark</h2>
                    <p>
                        Test the performance of the BMT hasher with different
                        data sizes (max 4096 bytes). The benchmark generates
                        unique random data for each iteration, ensuring that
                        each hash operation processes completely different data.
                        This approach prevents JIT optimizations, branch
                        prediction, and caching effects from artificially
                        improving the results.
                    </p>

                    <div class="benchmark-warning">
                        <strong>Note:</strong> For large numbers of iterations,
                        this will generate substantial amounts of random data in
                        memory. You'll be prompted for confirmation if the total
                        exceeds 500MB.
                    </div>

                    <div class="benchmark-controls">
                        <div class="benchmark-input">
                            <label for="benchmark-size"
                                >Data size (bytes):</label
                            >
                            <select id="benchmark-size">
                                <option value="64">64 bytes</option>
                                <option value="256">256 bytes</option>
                                <option value="512">512 bytes</option>
                                <option value="1024" selected>1 KB</option>
                                <option value="2048">2 KB</option>
                                <option value="4096">4 KB</option>
                            </select>
                        </div>

                        <div class="benchmark-input">
                            <label for="benchmark-iterations"
                                >Iterations:</label
                            >
                            <input
                                type="number"
                                id="benchmark-iterations"
                                min="1"
                                max="1000"
                                value="100"
                            />
                        </div>

                        <button id="run-benchmark" class="benchmark-button">
                            Run Benchmark
                        </button>
                    </div>

                    <div id="benchmark-results" class="benchmark-results">
                        <div id="result-placeholder">
                            Benchmark results will appear here.
                        </div>
                        <div
                            id="benchmark-output"
                            class="benchmark-output"
                        ></div>
                    </div>
                </div>
                <!-- Chunk Creator Tab -->
                <div id="chunk-creator" class="tab-pane">
                    <h2>Chunk Creator & Analyzer</h2>
                    <p>
                        Create and analyze different types of chunks used in
                        nectar's storage protocol.
                    </p>

                    <!-- Mode Selection -->
                    <div class="mode-selector">
                        <button id="create-mode-btn" class="mode-button active">
                            Create Chunk
                        </button>
                        <button id="analyze-mode-btn" class="mode-button">
                            Analyze Chunk
                        </button>
                    </div>

                    <!-- Creation Mode -->
                    <div id="chunk-create-mode" class="chunk-mode">
                        <div class="chunk-type-selector">
                            <div class="radio-option">
                                <input
                                    type="radio"
                                    id="content-chunk-type"
                                    name="chunk-type"
                                    value="content"
                                    checked
                                />
                                <label for="content-chunk-type"
                                    >Content Chunk</label
                                >
                            </div>
                            <div class="radio-option">
                                <input
                                    type="radio"
                                    id="single-owner-chunk-type"
                                    name="chunk-type"
                                    value="single-owner"
                                />
                                <label for="single-owner-chunk-type"
                                    >Single Owner Chunk</label
                                >
                            </div>
                        </div>

                        <!-- Content Chunk Form -->
                        <div id="content-chunk-form" class="chunk-form">
                            <div class="form-group">
                                <label for="content-chunk-data"
                                    >Chunk Data:</label
                                >
                                <div class="input-type-toggle">
                                    <div
                                        class="toggle-option active"
                                        data-format="text"
                                    >
                                        Text
                                    </div>
                                    <div
                                        class="toggle-option"
                                        data-format="hex"
                                    >
                                        Hex
                                    </div>
                                </div>
                                <textarea
                                    id="content-chunk-data"
                                    placeholder="Enter data to store in the chunk"
                                ></textarea>
                                <div class="input-info">
                                    <span id="content-data-size">0</span> bytes
                                    <span
                                        class="warning"
                                        id="content-data-warning"
                                    ></span>
                                </div>
                            </div>

                            <button
                                id="create-content-chunk"
                                class="primary-button"
                            >
                                Create Content Chunk
                            </button>
                        </div>

                        <!-- Single Owner Chunk Form -->
                        <div
                            id="single-owner-chunk-form"
                            class="chunk-form"
                            style="display: none"
                        >
                            <div class="form-group">
                                <label for="so-chunk-id"
                                    >Chunk ID (32 bytes):</label
                                >
                                <div class="input-with-button">
                                    <input
                                        type="text"
                                        id="so-chunk-id"
                                        placeholder="Enter or generate a chunk ID (64 hex characters)"
                                    />
                                    <button
                                        id="generate-chunk-id"
                                        class="inline-button"
                                    >
                                        Generate
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="private-key"
                                    >Private Key (32 bytes):</label
                                >
                                <div class="input-with-button">
                                    <input
                                        type="text"
                                        id="private-key"
                                        placeholder="Enter or generate a private key (64 hex characters)"
                                    />
                                    <button
                                        id="generate-private-key"
                                        class="inline-button"
                                    >
                                        Generate
                                    </button>
                                </div>
                            </div>

                            <div
                                class="form-group"
                                id="owner-address-container"
                                style="display: none"
                            >
                                <label>Owner Address:</label>
                                <div
                                    id="owner-address"
                                    class="readonly-value"
                                ></div>
                            </div>

                            <div class="form-group">
                                <label for="so-chunk-data">Chunk Data:</label>
                                <div class="input-type-toggle">
                                    <div
                                        class="toggle-option active"
                                        data-format="text"
                                    >
                                        Text
                                    </div>
                                    <div
                                        class="toggle-option"
                                        data-format="hex"
                                    >
                                        Hex
                                    </div>
                                </div>
                                <textarea
                                    id="so-chunk-data"
                                    placeholder="Enter data to store in the chunk"
                                ></textarea>
                                <div class="input-info">
                                    <span id="so-data-size">0</span> bytes
                                    <span
                                        class="warning"
                                        id="so-data-warning"
                                    ></span>
                                </div>
                            </div>

                            <button id="create-so-chunk" class="primary-button">
                                Create Single Owner Chunk
                            </button>
                        </div>

                        <!-- Creation Result -->
                        <div
                            id="chunk-creation-result"
                            class="result-container"
                            style="display: none"
                        >
                            <h3>Created Chunk</h3>

                            <div class="output-grid">
                                <div class="output-cell">
                                    <div class="icon-preview-container">
                                        <h4>Chunk Icon</h4>
                                        <div id="created-chunk-icon"></div>
                                    </div>
                                </div>

                                <div class="output-cell">
                                    <div class="result-info">
                                        <div class="result-field">
                                            <label>Chunk Type:</label>
                                            <div
                                                id="result-chunk-type"
                                                class="readonly-value"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Chunk Address:</label>
                                            <div
                                                id="result-chunk-address"
                                                class="readonly-value copy-enabled"
                                            ></div>
                                        </div>

                                        <div
                                            id="result-id-field"
                                            class="result-field"
                                            style="display: none"
                                        >
                                            <label>Chunk ID:</label>
                                            <div
                                                id="result-chunk-id"
                                                class="readonly-value copy-enabled"
                                            ></div>
                                        </div>

                                        <div
                                            id="result-owner-field"
                                            class="result-field"
                                            style="display: none"
                                        >
                                            <label>Owner Address:</label>
                                            <div
                                                id="result-owner-address"
                                                class="readonly-value copy-enabled"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Data Size:</label>
                                            <div
                                                id="result-data-size"
                                                class="readonly-value"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Total Size:</label>
                                            <div
                                                id="result-total-size"
                                                class="readonly-value"
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="result-actions">
                                <button
                                    id="copy-serialized-chunk"
                                    class="action-button"
                                >
                                    Copy Serialized Chunk
                                </button>
                                <button
                                    id="download-serialized-chunk"
                                    class="action-button"
                                >
                                    Download Chunk
                                </button>
                                <button
                                    id="create-new-chunk"
                                    class="action-button"
                                >
                                    Create New Chunk
                                </button>
                            </div>

                            <div class="serialized-data">
                                <h4>Serialized Chunk Data (Hex)</h4>
                                <pre id="serialized-chunk-data"></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Mode -->
                    <div
                        id="chunk-analyze-mode"
                        class="chunk-mode"
                        style="display: none"
                    >
                        <div class="form-group">
                            <label for="chunk-data-hex"
                                >Serialized Chunk Data (hex):</label
                            >
                            <textarea
                                id="chunk-data-hex"
                                placeholder="Enter serialized chunk data as hex"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="expected-address"
                                >Expected Address (hex):</label
                            >
                            <input
                                type="text"
                                id="expected-address"
                                placeholder="Enter the expected chunk address (64 hex characters)"
                            />
                            <div class="input-info">
                                <span class="info"
                                    >The expected address is needed to verify
                                    the chunk's authenticity</span
                                >
                            </div>
                        </div>

                        <button id="analyze-chunk-btn" class="primary-button">
                            Analyze Chunk
                        </button>

                        <!-- Analysis Result -->
                        <div
                            id="chunk-analysis-result"
                            class="result-container"
                            style="display: none"
                        >
                            <div
                                id="analysis-valid"
                                class="analysis-status valid"
                            >
                                <h3>Valid Chunk Detected</h3>
                            </div>
                            <div
                                id="analysis-invalid"
                                class="analysis-status invalid"
                                style="display: none"
                            >
                                <h3>Invalid Chunk</h3>
                                <div
                                    id="analysis-error"
                                    class="error-message"
                                ></div>
                            </div>

                            <div class="output-grid">
                                <div class="output-cell">
                                    <div class="icon-preview-container">
                                        <h4>Chunk Icon</h4>
                                        <div id="analyzed-chunk-icon"></div>
                                    </div>
                                </div>

                                <div class="output-cell">
                                    <div class="result-info">
                                        <div class="result-field">
                                            <label>Chunk Type:</label>
                                            <div
                                                id="analysis-chunk-type"
                                                class="readonly-value"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Chunk Address:</label>
                                            <div
                                                id="analysis-chunk-address"
                                                class="readonly-value copy-enabled"
                                            ></div>
                                        </div>

                                        <div
                                            id="analysis-id-field"
                                            class="result-field"
                                            style="display: none"
                                        >
                                            <label>Chunk ID:</label>
                                            <div
                                                id="analysis-chunk-id"
                                                class="readonly-value copy-enabled"
                                            ></div>
                                        </div>

                                        <div
                                            id="analysis-owner-field"
                                            class="result-field"
                                            style="display: none"
                                        >
                                            <label>Owner Address:</label>
                                            <div
                                                id="analysis-owner-address"
                                                class="readonly-value copy-enabled"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Data Size:</label>
                                            <div
                                                id="analysis-data-size"
                                                class="readonly-value"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Total Size:</label>
                                            <div
                                                id="analysis-total-size"
                                                class="readonly-value"
                                            ></div>
                                        </div>

                                        <div class="result-field">
                                            <label>Chunk Data:</label>
                                            <div
                                                class="input-type-toggle small"
                                            >
                                                <div
                                                    class="toggle-option active"
                                                    data-format="hex"
                                                    data-target="analysis-chunk-data"
                                                >
                                                    Hex
                                                </div>
                                                <div
                                                    class="toggle-option"
                                                    data-format="text"
                                                    data-target="analysis-chunk-data"
                                                >
                                                    UTF-8
                                                </div>
                                            </div>
                                            <pre
                                                id="analysis-chunk-data-hex"
                                                class="code-output"
                                            ></pre>
                                            <pre
                                                id="analysis-chunk-data-text"
                                                class="code-output"
                                                style="display: none"
                                            ></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="result-actions">
                                <button
                                    id="copy-analyzed-data"
                                    class="action-button"
                                >
                                    Copy Raw Data
                                </button>
                                <button
                                    id="analyze-new-chunk"
                                    class="action-button"
                                >
                                    Analyze New Chunk
                                </button>
                            </div>
                        </div>
                    </div>

                    <details class="info-panel">
                        <summary>About Chunks</summary>
                        <div class="info-content">
                            <h4>Content Chunks</h4>
                            <p>
                                Content chunks are simple content-addressed
                                containers. Their address is derived directly
                                from the binary Merkle tree (BMT) hash of their
                                data, making them immutable and self-verifying.
                            </p>

                            <h4>Single Owner Chunks</h4>
                            <p>
                                Single owner chunks include a unique ID and are
                                cryptographically signed by their owner. Their
                                address is derived from both the ID and the
                                owner's address, allowing for ownership
                                verification and controlled updates.
                            </p>

                            <h4>Chunk Structure</h4>
                            <pre>
                Content Chunk:  [data]
                Single Owner:   [ID (32 bytes)][signature (65 bytes)][span (8 bytes)][data]</pre
                            >
                        </div>
                    </details>
                </div>
            </div>
        </main>

        <footer>
            <div id="library-info"></div>
        </footer>

        <script data-trunk src="./js/app.js" type="module"></script>
    </body>
</html>
